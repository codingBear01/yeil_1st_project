{% extends "main/layout.html" %} 
{% load static %}

{% block main %} 
  {% if user.is_authenticated %}
    {% if group.groupPic %}
    <img src="{{ group.groupPic.url }}" alt="group_pic" width="200" />
    {% else %}
    <i class="fa-solid fa-user-large default_group_pic"></i>
    {% endif %}
    
    <a href="{% url 'userPage:userPage' group.user.id %}">
      작성자: {{ group.user }}
    </a>
    <div>목표: {{ group.target }}</div>
    <div>제목: {{ group.title }}</div>
    <div>내용: {{ group.content }}</div>
    <div>참가 정원: {{ group.memberCount }}</div>
    <div>참가자 수: <span class="joined_user_cnt">{{ group.joinedUser.count }} 명</span></div>
    <div>시작일: {{ group.startDay }}</div>
    <div>종료일: {{ group.finishDay }}</div>
    <div>작성 시간: {{ group.serialize.createdTime }}</div>
    <div
    id="group_like_{{ group.pk }}"
    class="like_box group_like like "
    group-id="{{ group.pk }}"
    {% if not request.user in group.like.all %}
    group-is-liked="no"
    {% else %}
    group-is-liked="yes"
    {% endif %}
    {% if group.user.pk == request.user.pk %} 
    disabled 
    {% endif %}
    >
      <span id="group_heart_{{ group.pk }}">
        {% if not request.user in group.like.all %}
        🤍
        {% else %}
        💖
        {% endif %}
      </span>
      <span id="group_like_count_{{ group.pk }}">{{ group.like.count }}</span>
    </div>
    <button 
      class="join_group_btn" 
      group-id="{{ group.pk }}"
      {% if group.user.pk == request.user.pk %}
      disabled
      {% endif %}
    >참가</button>
    <a href="{% url 'group:all_groups' %}">see all groups</a>
    {% if user.id == group.user.id %}
    <a href="{% url 'group:edit' group.id %}">edit this group</a>
    <form
      action="{% url 'group:delete' group.id %}"
      method="POST"
      style="display: flex; flex-direction: column"
    >
      {% csrf_token%}
      <input type="submit" value="delete this page" />
    </form>
    {% endif %}
    {% for joinedUser in group.joinedUser.all %}
    <ul class="group_joined_user_list">
      <li>
        <div>
          <img 
            src="{{ joinedUser.profilePic.url }}" 
            style="width: 30px; height: 30px; border-radius: 50%;"/>
          {{ joinedUser.nickname }}
        </div>
      </li>
    </ul>
    {% endfor %}
  {% endif %} 
{% endblock %}

{% block script %}
<script src="{% static 'group/javascript/joinGroup.js' %}"></script>
<script src="{% static 'group/javascript/groupLike.js' %}"></script>
{% endblock %}
